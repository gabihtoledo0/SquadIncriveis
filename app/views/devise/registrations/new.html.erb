<img src="<%= image_url('icon-chat.png')%>" widht="204" height="155" class="cadastrar" alt="chat0"
  style="margin-top: 100px">
</br>
<h7 class=fonte-titulo-cadastro> Especialista em ser uma incrível</h7>
<br />
<br />
<%= form_for(resource, as: resource_name, url: registration_path(resource_name)) do |f| %>
<%= render "devise/shared/error_messages", resource: resource %>

<div class="container bg-green container-cad justify-content-center">

  <div class="row " id="esc_geral">
    <img src="<%= image_url('chat1.png')%>" class="cadastrar" alt="chat1">
  </div>
  <div class="row">
    <div class="col-sm field .col-12 .col-md-8" style="margin-left: 620px;">
      </br>
      </br>
      <%= f.select :pf_pj, pfpj %>

    </div>
    <div class="col-sm field" align="right">
      <img src="<%= image_url('youse-chat.png')%>" class="you" alt="youser">
    </div>
  </div>

  <div id="esc_nomec" style="display:none;" class="tracking-in-expand-fwd-bottom">
    <div class="row">
      <img src="<%= image_url('chat2.png')%>" class="cadastrar" alt="chat2">
    </div>
    <div class="row">
      <div class="col-sm field .col-12 .col-md-8" style="margin-left: 450px;">
        </br>
        <%= f.text_field :fullname, autofocus: true, :class => "caixa-de-texto-cad borda-caixa-texto", :placeholder => "Ex: Youser da Silva Moraes"%>
        <small id="fullnameHelp" class="form-text text-muted">Seu nome deve conter no máximo 50 caractéres
        </br> e apenas Letras e Espaços são permitidos ;)</small>
      </br>
      </div>
      <div class="col-sm field" align="right">
        <img src="<%= image_url('youse-chat.png')%>" class="you" alt="youser">
      </div>

    </div>
  </div>

  <div id="esc_cpf" style="display:none;" class="tracking-in-expand-fwd-bottom">
    <div class="row">
      <img src="<%= image_url('chat3.png')%>" class="cadastrar" alt="chat3">
    </div>
    <div class="row">
      <div class="col-sm field .col-12 .col-md-8" style="margin-left: 450px;" data-placement="top" data-trigger= "manual" data-toggle="popover" data-content="CPF inválido" id ="text-cpf">
        </br>

        <%= f.text_field :cpf, autofocus: true, :class => "caixa-de-texto-cad borda-caixa-texto", :placeholder => "000.000.000-00"%>
      </div>
      <div class="col-sm field" align="right">
        <img src="<%= image_url('youse-chat.png')%>" class="you" alt="youser">
      </div>


    </div>
  </div>

  <div id="esc_razao" style=" display:none;" class="tracking-in-expand-fwd-bottom">
    <div class="row">
      <img src="<%= image_url('chat4.png')%>" class="cadastrar" alt="chat3">
    </div>
    <div class="row">
      <div class="col-sm field .col-12 .col-md-8" style="margin-left: 450px;">
        </br>
        <%= f.text_field :razaosocial, autofocus: true, :class => "caixa-de-texto-cad borda-caixa-texto", :placeholder => "Ex: Youse Seguradora S.A"%>
      </div>
      <div class="col-sm field" align="right">
        <img src="<%= image_url('youse-chat.png')%>" class="you" alt="youser">
      </div>

    </div>
  </div>

  <div id="esc_cnpj" style=" display:none;" class="tracking-in-expand-fwd-bottom">
    <div class="row">
      <img src="<%= image_url('chat5.png')%>" class="cadastrar" alt="chat3">
    </div>
    <div class="row">
      <div class="col-sm field .col-12 .col-md-8" style="margin-left: 450px;" data-placement="top" data-trigger= "manual" data-toggle="popover" data-content="CPNJ inválido" id ="text-cnpj">
        </br>
        <%= f.text_field :cnpj, autofocus: true, :class => "caixa-de-texto-cad borda-caixa-texto", :placeholder => "00.000.000/0000.00"%>

      </div>
      <div class="col-sm field" align="right">
        <img src="<%= image_url('youse-chat.png')%>" class="you" alt="youser">
      </div>

    </div>
  </div>
  <div id="esc_email" style="display:none;" class="tracking-in-expand-fwd-bottom">
    <div class="row">
      <img src="<%= image_url('chat6.png')%>" class="cadastrar" alt="chat8" align="left">
    </div>
    <div class="row">
      <div class="col-sm field .col-12 .col-md-8" style="margin-left: 460px;" data-placement="top" data-trigger= "manual"  data-toggle="popover" data-content="O email deve ser @youse.com.br" id ="text-email">
        <%= f.email_field :email, autofocus: true, autocomplete: "Email", :class => "caixa-de-texto-cad borda-caixa-texto", :placeholder  => 
        "exemplo@youse.com.br"%>
      </div>
      <div class="col-sm field" align="right">
        <img src="<%= image_url('youse-chat.png')%>" class="you" alt="youser">
      </div>
    </div>
  </div>

  <div id="esc_senha" style="display:none;" class="tracking-in-expand-fwd-bottom">
    <div class="row">
      <img src="<%= image_url('chat7.png')%>" class="cadastrar" alt="chat9" align="left">
    </div>
  
    <div class="row">
      <div class="col-sm field .col-12 .col-md-8" style="margin-left: 450px;" data-placement="top" data-trigger= "manual" data-toggle="popover" data-content="Senha inválida" id ="text-senha">
        </br>
        <%= f.password_field :password, autocomplete: "Senha", :class => "caixa-de-texto-cad borda-caixa-texto" , :placeholder => "Ex: @Youser123"%>
        <small id="senhaHelp" class="form-text text-muted">A senha deve conter 8 Caracteres: Letra Maiúscula e
          </br> Minúscula,
          Caracter especial e Número</small>
      </div>
      <div class="col-sm field" align="right">
        <img src="<%= image_url('youse-chat.png')%>" class="you" alt="youser">
      </div>
    </div>
  </div>

  <div id="esc_conf" style="display:none;" class="tracking-in-expand-fwd-bottom">
    <div class="row">
      <img src="<%= image_url('chat8.png')%>" class="cadastrar" alt="chat10" align="left">
    </div>
    <div class="row">
      <div class="col-sm field .col-12 .col-md-8" style="margin-left: 450px;"data-placement="top" data-trigger= "manual" data-toggle="popover" data-content="Senhas não conferem" id ="text-senhaconf">
        </br>
        <%= f.password_field :password_confirmation, autocomplete: "new-password" , :class => "caixa-de-texto-cad borda-caixa-texto" , :placeholder => "Confirme sua senha"%>
      </div>
      <div class="col-sm field" align="right">
          <img src="<%= image_url('youse-chat.png')%>" class="you" alt="youser">
        </div>
      
    </div>
  </div>

  <div id="esc_cep" style="display:none;" class="tracking-in-expand-fwd-bottom">
    <div class="row">
      <img src="<%= image_url('chat9.png')%>" class="cadastrar" alt="chat6">
    </div>
    <div class="row">

      <div class="col-sm field .col-12 .col-md-8" style="margin-left: 450px;" data-placement="top" data-trigger= "manual" data-toggle="popover" data-content="O  CEP não é válido" id ="text-cep">
        </br>
        <%= f.text_field :cep, autofocus: true, :class => "caixa-de-texto-cad borda-caixa-texto", :placeholder => "00000-000"%>
        <small id="cepHelp" class="form-text text-muted" style="display:none;">*Campo não obrigatório</small>
      </div>
      <div class="col-sm field" align="right">
        <img src="<%= image_url('youse-chat.png')%>" class="you" alt="youser">
      </div>
    </div>
  </div>


  <div id="esc_est" style="display:none;" class="tracking-in-expand-fwd-bottom">
    <div class="col-sm field .col-12 .col-md-8" style="margin-left: 230px;">
      </br>
      <%= f.select :estado, states, autofocus: true %>
      <small id="estadHelp" class="form-text text-muted">*Campo não obrigatório</small>
    </div>
  </div>

  <div id="esc_cid" style="display:none;" class="tracking-in-expand-fwd-bottom">
    <div class="col-sm field .col-12 .col-md-8" style="margin-left: 170px;">
      </br>
    <%= f.text_field :cidade, autofocus: true , :class => "caixa-de-texto-cad borda-caixa-texto", :placeholder => "Cidade"%>
    <small id="cidHelp" class="form-text text-muted">*Campo não obrigatório</small>
  </div>
  </div>
  </br>

  <div id="esc_bairro" style="display:none;" class="tracking-in-expand-fwd-bottom">
  <div class="col-sm field .col-12 .col-md-8" style="margin-left: 170px;">
    <%= f.text_field :bairro, autofocus: true, :class => "caixa-de-texto-cad borda-caixa-texto", :placeholder => "Estado"%>
    <small id="bairroHelp" class="form-text text-muted" >*Campo não obrigatório</small>
  </div>
  </div>
  </br>

  <div id="esc_rua" style="display:none;" class="tracking-in-expand-fwd-bottom">
  <div class="col-sm field .col-12 .col-md-8" style="margin-left: 170px;">
    <%= f.text_field :rua, autofocus: true, :class => "caixa-de-texto-cad borda-caixa-texto", :placeholder => "Logradouro"%>
    <small id="ruaHelp" class="form-text text-muted">*Campo não obrigatório</small>
  </div>
  </div>
  </br>

  <div id="esc_num" style="display:none;" class="tracking-in-expand-fwd-bottom">
    <div class="row">
      <img src="<%= image_url('chat10.png')%>" class="cadastrar" alt="chat8" align="left">
    </div>
    </br>
    <div class="row">
      <div class="col-sm field .col-12 .col-md-8" style="margin-left: 460px;">
        <%= f.text_field :numero, autofocus: true, :class => "caixa-de-texto-cad borda-caixa-texto", :placeholder => "Ex: 4285"%>
        <small id="numHelp" class="form-text text-muted">*Campo não obrigatório</small>
      </div>
      <div class="col-sm field" align="right">
        <img src="<%= image_url('youse-chat.png')%>" class="you" alt="youser">
      </div>
    </div>
  </div>

    <div id="esc_botao" style="display:none;" class="tracking-in-expand-fwd-bottom">
      <div class="row">
        <img src="<%= image_url('chat11.png')%>" class="cadastrar" alt="chat11" align="left">
      </div>
    </br>
    <div class="row">
      <div class="col-sm field justify-content-center">
        <%= f.submit "FINALIZAR", :class => "btn botao"%>
      </div>
    </div>
  </div>
  <div id="esc_text" style="display: none;" class="tracking-in-expand-fwd-bottom">
    <h6 class=fonte-titulo-cadastro> Preencha todos os campos para continuarmos seu cadastro :) </h6>
  </div>

</br>

<%= link_to "Voltar", new_session_path(resource_name), class: "link back-link" %><br />

</br> 
<% end %>

<script type="text/javascript">

function TestaCPF(strCPF) {
    strCPF = strCPF.replace(/[^0-9]/g, '');
    var Soma;
    var Resto;
    Soma = 0;
    if (strCPF == "00000000000") return false;
    for (i = 1; i <= 9; i++) Soma = Soma + parseInt(strCPF.substring(i - 1, i)) * (11 - i);
    Resto = (Soma * 10) % 11;
    if ((Resto == 10) || (Resto == 11)) Resto = 0;
    if (Resto != parseInt(strCPF.substring(9, 10))) return false;
    Soma = 0;
    for (i = 1; i <= 10; i++) Soma = Soma + parseInt(strCPF.substring(i - 1, i)) * (12 - i);
    Resto = (Soma * 10) % 11;
    if ((Resto == 10) || (Resto == 11)) Resto = 0;
    if (Resto != parseInt(strCPF.substring(10, 11))) return false;
    return true;
  }

function TestaCNPJ(cnpj) {
    cnpj = cnpj.replace(/[^\d]+/g, '');
    if (cnpj == '') return false;
    if (cnpj.length != 14)
      return false;
    if (cnpj == "00000000000000" ||
      cnpj == "11111111111111" ||
      cnpj == "22222222222222" ||
      cnpj == "33333333333333" ||
      cnpj == "44444444444444" ||
      cnpj == "55555555555555" ||
      cnpj == "66666666666666" ||
      cnpj == "77777777777777" ||
      cnpj == "88888888888888" ||
      cnpj == "99999999999999")
      return false;
    // Valida DVs
    tamanho = cnpj.length - 2
    numeros = cnpj.substring(0, tamanho);
    digitos = cnpj.substring(tamanho);
    soma = 0;
    pos = tamanho - 7;
    for (i = tamanho; i >= 1; i--) {
      soma += numeros.charAt(tamanho - i) * pos--;
      if (pos < 2)
        pos = 9;
    }
    resultado = soma % 11 < 2 ? 0 : 11 - soma % 11;
    if (resultado != digitos.charAt(0))
      return false;
    tamanho = tamanho + 1;
    numeros = cnpj.substring(0, tamanho);
    soma = 0;
    pos = tamanho - 7;
    for (i = tamanho; i >= 1; i--) {
      soma += numeros.charAt(tamanho - i) * pos--;
      if (pos < 2)
        pos = 9;
    }
    resultado = soma % 11 < 2 ? 0 : 11 - soma % 11;
    if (resultado != digitos.charAt(1))
      return false;
    return true;
  }

  $(document).ready(function () {
    $("#user_cep").keyup(function () {
      if ($(this).val().length == 9) {
        $.ajax({
          url: 'https://viacep.com.br/ws/' + $(this).val() + '/json/unicode/',
          dataType: 'json',
          success: function (resposta) {
            $("#user_rua").val(resposta.logradouro);
            $("#complemento").val(resposta.complemento);
            $("#user_bairro").val(resposta.bairro);
            $("#user_cidade").val(resposta.localidade);
            $("#user_estado").val(resposta.uf);
            if (resposta.erro !== true ){
              $("#user_cep").css("border-color", "green");
              $('#text-cep').popover('hide')
            }
            else {
              $("#user_cep").css("border-color", "red"); 
              $('#text-cep').popover('show') 
            }
          }
        });
      }
      else if ($(this).val().length > 0){
        $("#user_cep").css("border-color", "orange");
        $("#user_rua").val("");
            $("#complemento").val("");
            $("#user_bairro").val("");
            $("#user_cidade").val("");
            $("#user_estado").val("");
            $('#text-cep').popover('show') 
      }
      else{
            $("#user_cep").css("border-color", "rgb(132, 46, 176)");
            $("#user_rua").val("");
            $("#complemento").val("");
            $("#user_bairro").val("");
            $("#user_cidade").val("");
            $("#user_estado").val("");
            $('#text-cep').popover('hide') 
      }
    });
    $('#user_cpf').mask('000.000.000-00');
    $('#user_cep').mask('00000-000');
    $('#user_cnpj').mask('00.000.000/0000-00');
    jQuery('#user_fullname').keyup(function () { 
   this.value = this.value.replace(/[^A-Za-záàâãéèêíïóôõöúçñÁÀÂÃÉÈÍÏÓÔÕÖÚÇÑ ]/g,'');
 });
    
    $("#user_pf_pj").change(function () {
      $('.back-link').hide();

      if ($(this).val() === "PF") {
        $("#esc_razao").hide();
        $("#esc_cnpj").hide();
        $("#esc_nomec").show();
        $("#esc_cpf").show();
        $("#user_razaosocial").val('');
        $("#user_cnpj").val('');
        $("#user_razaosocial").css("border-color","rgb(132, 46, 176)");
        $("#user_cnpj").css("border-color","rgb(132, 46, 176)");
        $('#text-cnpj').popover('hide')
      } else {
        $("#esc_razao").show();
        $("#esc_cnpj").show();
        $("#esc_nomec").hide();
        $("#esc_cpf").hide();
        $("#user_fullname").val('');
        $("#user_cpf").val('');
        $("#user_fullname").css("border-color","rgb(132, 46, 176)");
        $("#user_cpf").css("border-color","rgb(132, 46, 176)");
        $('#text-cpf').popover('hide');
      }
      
      setTimeout(function() { 
        $('.back-link').show();
      }, 1000);
    });
    
    $("#user_cpf").keyup(function () {
      if (TestaCPF($(this).val()) && $('#user_fullname').val().length > 0) {
        $("#esc_email").show();
        $("#esc_senha").show();
        $("#esc_conf").show();
      }
    });
    $("#user_fullname").keyup(function () {
      if ($(this).val().length > 0){
        $(this).css("border-color", "green");
      }
      else{
        $(this).css("border-color", "rgb(132, 46, 176)");
      }
      if ($(this).val().length > 0 && $('#user_cpf').val().length === 14) {
        $("#esc_email").show();
        $("#esc_senha").show();
        $("#esc_conf").show();
      }
    });
    $("#user_cnpj").keyup(function () {
      if (TestaCNPJ($(this).val()) && $('#user_razaosocial').val().length > 0) {
        $("#esc_email").show();
        $("#esc_senha").show();
        $("#esc_conf").show();
      }
    });
    $("#user_razaosocial").keyup(function () {
      if ($(this).val().length > 0) {
        $(this).css("border-color","green");
      }
      else{
        $(this).css("border-color","rgb(132, 46, 176)");
      }
      if ($(this).val().length > 0 && $('#user_cnpj').val().length === 18) {
        $("#esc_email").show();
        $("#esc_senha").show();
        $("#esc_conf").show();
      }
    });
    $("#user_password_confirmation").keyup(function () {
      if ($(this).val().length > 7) {
        $("#esc_cep").show();
        $("#esc_est").show();
        $("#esc_cid").show();
        $("#esc_bairro").show();
        $("#esc_rua").show();
        $("#esc_num").show();
        $("#esc_botao").show();
      }
    });
    if ($('#lanaerror_explanation').length > 0) {
      var cnpjCpf = $("#user_pf_pj").val();
      $("#esc_cep").show();
      $("#esc_est").show();
      $("#esc_cid").show();
      $("#esc_bairro").show();
      $("#esc_rua").show();
      $("#esc_num").show();
      $("#esc_botao").show();
      $("#esc_email").show();
      $("#esc_senha").show();
      $("#esc_conf").show();
      if (cnpjCpf == 'PF') {
        $("#esc_nomec").show();
        $("#esc_cpf").show();
      } else {
        $("#esc_razao").show();
        $("#esc_cnpj").show();
      }
    }
    $("#user_pf_pj").change(function () {
      if ($(this).val() === 'PF') {
        $("#cepHelp").show();
        $("#estHelp").show();
        $("#cidHelp").show();
        $("#bairroHelp").show();
        $("#ruaHelp").show();
        $("#numHelp").show();
      }
      else {
        $("#cepHelp").hide();
        $("#ruaHelp").show();
        $("#numHelp").show();
        $("#estHelp").show();
        $("#cidHelp").show();
        $("#bairroHelp").show();
      }
    })

    $(this).scrollTop(0);

    jQuery(function () {
    $("#user_email").keyup(function () {
      if($(this).val().length > 0){
        var VAL = this.value;

        var email = new RegExp('^[a-z0-9](\.?[a-z0-9])+@youse.com.br$');

        if (email.test(VAL)) {
        
          $(this).css("border-color", "green");
          $('#text-email').popover('hide')
        }
        else {
          $(this).css("border-color", "red");
          $('#text-email').popover('show')
        }
      }
      else{
        $(this).css("border-color", "rgb(132, 46, 176)");
      }
    });


    
    $("#user_password").keyup(function () {
        var VAL = this.value;

        var password = new RegExp('(?=^.{8,}$)(?=.*[0-9])(?=.*[A-Z])(?=.*[a-z])(?=.*[^A-Za-z0-9]).*');
      if($(this).val().length > 0){
        if (password.test(VAL)) {
          $(this).css("border-color", "green");
          $('#text-senha').popover('hide')
        }
        else {
          $(this).css("border-color", "red");
          $('#text-senha').popover('show')
        }
      }
      else {
      $(this).css("border-color", "rgb(132, 46, 176)");
      if ($("#user_password_confirmation").val().length == 0){
        $("#user_password_confirmation").css("border-color", "rgb(132, 46, 176)");
      }
      }
      if ($("#user_password_confirmation").val().length > 0){
      if ($(this).val() !== $("#user_password_confirmation").val()) {
        $("#user_password_confirmation").css("border-color", "red");
          $('#text-senhaconf').popover('show')
          
      }
      else {
        $("#user_password_confirmation").css("border-color", "green");
        $('#text-senhaconf').popover('hide')
      }
      }
    });

    $("#user_password_confirmation").keyup(function() {
      if ($(this).val().length > 0){
      if ($(this).val() !== $("#user_password").val() ) {
        $(this).css("border-color", "red");
        $('#text-senhaconf').popover('show')
       
      }
      else {
        $(this).css("border-color", "green");
        $('#text-senhaconf').popover('hide')
        
       }
      }
      else{
        $(this).css("border-color", "rgb(132, 46, 176)");
      }
     })
    });

  });

  $("#user_cpf").keyup(function(){
    if ($(this).val().length == 14){
    if (TestaCPF($(this).val())) {
          $(this).css("border-color", "green");
          $('#text-cpf').popover('hide')
        }
        else {
          $(this).css("border-color", "red");
          $('#text-cpf').popover('show')
        }
    }
    else if($(this).val().length >0){
        $(this).css("border-color", "orange");
        $('#text-cpf').popover('show')
      }
      else{
        $(this).css("border-color", "rgb(132, 46, 176)");
        $('#text-cpf').popover('hide')
      }
  })

  $("#user_cnpj").keyup(function(){
    if ($(this).val().length == 18){
    if (TestaCNPJ($(this).val())) {
          $(this).css("border-color", "green");
          $('#text-cnpj').popover('hide')
        }
        else {
          $(this).css("border-color", "red");
          $('#text-cnpj').popover('show')
        }
    }
    else if($(this).val().length >0){
        $(this).css("border-color", "orange");
        $('#text-cnpj').popover('show')
      }
      else{
        $(this).css("border-color", "rgb(132, 46, 176)");
        $('#text-cnpj').popover('hide')
      }
  })

</script>

</div>

